{{define "settings/index"}}
{{template "common/header" .}}
<div class="container">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">交付结果推送</h5>
            <div class="card-subtitle mb-2 text-muted">
                <p>更灵活的自定义 Webhook</p>
                可替换参数：触发者<code>#Pusher#</code>、日志<code>#Log#</code>、流程备注<code>#PipelineName#</code>、部署结果<code>#Status#</code>、流程ID<code>#PipelineID#</code>、部署开始时间<code>#StartedAt#</code>、部署结束时间<code>#StoppedAt#</code>。
                <br>
                可替换字段：<b>URL</b>、<b>Body</b> 的内容均能替换，如果是 GET 请求请把 query 参数以 JSON key value 格式放到 body 字段里面，方便
                URLEncode
                <br>
                Body 的格式是 <code>{"key":"value"}</code> 对应的是 Go 里面 <code>map[string]string</code> 的序列化。填写完可以到 <a
                    href="https://www.bejson.com/" target="_blank">JSON 校验工具</a> 校验一下是否正确。
            </div>
            <form id="formNotify" onsubmit="return setNotification()">
                <div class="form-group">
                    <label for="URLInput">URL</label>
                    <input name="webhook_url" required type="text" class="form-control" id="URLInput"
                        placeholder="https://example.com/callback/#PipelineID#" value="{{.user.WebhookURL}}">
                </div>
                <div class="form-group">
                    <label for="methodSelect">请求方式</label>
                    <select name="request_method" class="form-control" id="methodSelect">
                        <option value="1">Get</option>
                        <option value="2">Post</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="typeSelect">请求格式</label>
                    <select name="request_type" class="form-control" id="typeSelect">
                        <option value="1">JSON</option>
                        <option value="2">Form</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="bodyTextarea">Body</label>
                    <textarea name="request_body" class="form-control" id="bodyTextarea" rows="3"
                        placeholder='{"msg":"#Pusher#推送到仓库。\n这是日志：\n#Log#"}'>{{.user.RequestBody}}</textarea>
                </div>
                <div class="form-check mb-3">
                    <input {{if .user.VerifySSL}}checked{{end}} name="verify_ssl" type="checkbox" value="true"
                        class="form-check-input" id="inputOnlyError">
                    <label class="form-check-label" for="inputOnlyError">验证 SSL</label>
                </div>
                <div class="form-check mb-3">
                    <input {{if .user.PushSuccess}}checked{{end}} name="push_success" type="checkbox" value="true"
                        class="form-check-input" id="inputOnlyError">
                    <label class="form-check-label" for="inputOnlyError">推送交付成功的通知</label>
                </div>
                {{.csrf_token}}
                <button type="submit" class="btn btn-primary">保存配置</button>
            </form>
        </div>
    </div>
</div>
{{template "common/footer" .}}
{{end}}